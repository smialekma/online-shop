{% load static %}
{% load crispy_forms_tags %}
{% include "dashboard/login_header.html" %}
<!-- Breadcrumb -->
<div id="breadcrumb">
    <div class="container">
        <h3 class="breadcrumb-header">Order #{{ object.id }}</h3>
        <ul class="breadcrumb-tree">
            <li>
                <a href="{% url "home-view" %}">Home</a>
            </li>
            <li>
                <a href="{% url "management-view" %}">Management panel</a>
            </li>
            <li>
                <a href="{% url "management-orders" %}">Orders</a>
            </li>
            <li class="active">Order #{{ object.id }}</li>
        </ul>
    </div>
</div>
<div class="container" style="margin-top:30px;max-width:700px;">
    <section class="section"
             style="background:#FFF;
                    padding:20px;
                    border:1px solid #E4E7ED;
                    border-radius:10px">
        <form method="post">
            {% csrf_token %}
            {{ form|crispy }}
            {% if object.address %}
                <div style="margin-top:-10px;margin-bottom:20px;">
                    <a href="{% url "management-address-update" object.address.id %}">✏️ Edit address</a>
                </div>
            {% endif %}
            <div class="form-buttons">
                <button type="submit" class="primary-btn">Save</button>
                <a href="{% url "management-orders" %}"
                   class="primary-btn"
                   style="background:#999">Cancel</a>
            </div>
        </form>
        <!-- Read-only Order Items section -->
        <hr style="margin:30px 0;border-color:#E4E7ED;">
        <h4 style="margin-bottom:15px;">Order items</h4>
        {% if items %}
            <div style="overflow-x:auto;">
                <table style="width:100%;border-collapse:collapse;">
                    <thead>
                        <tr style="border-bottom:1px solid #E4E7ED;text-align:left;">
                            <th style="padding:8px;">Product</th>
                            <th style="padding:8px;">Quantity</th>
                            <th style="padding:8px;">Unit Price</th>
                            <th style="padding:8px;">Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                            <tr style="border-bottom:1px solid #F5F5F5;">
                                <td style="padding:8px;">{{ item.product.name }}</td>
                                <td style="padding:8px;">{{ item.quantity }}</td>
                                <td style="padding:8px;">{{ item.product.price }}</td>
                                <td style="padding:8px;">{{ item.get_subtotal }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="color:#888;">No products linked to this order.</p>
        {% endif %}
    </section>
</div>
<footer id="bottom-footer" style="margin-top:40px;padding:20px 0;">
</footer>

{% load static %}
{% load crispy_forms_filters %}
{% include "dashboard/login_header.html" %}
<!-- Breadcrumb -->
<div id="breadcrumb">
    <div class="container">
        <h3 class="breadcrumb-header">Payments</h3>
        <ul class="breadcrumb-tree">
            <li>
                <a href="{% url "home-view" %}">Home</a>
            </li>
            <li>
                <a href="{% url "management-view" %}">Management panel</a>
            </li>
            <li class="active">Payments</li>
        </ul>
    </div>
</div>
<div class="container" style="margin-top:30px;">
    <!-- Filters -->
    <section class="section"
             style="background:#FFF;
                    padding:15px;
                    border:1px solid #E4E7ED;
                    border-radius:8px">
        <form method="get"
              style="display:flex;
                     gap:20px;
                     flex-wrap:wrap;
                     align-items:center">
            <div>
                <label for="status">Status:</label>
                <br>
                {{ filter.form.is_paid|as_crispy_field }}
            </div>
            <div>
                <label for="date_from">From:</label>
                <br>
                {{ filter.form.date_from|as_crispy_field }}
            </div>
            <div>
                <label for="date_to">To:</label>
                <br>
                {{ filter.form.date_to|as_crispy_field }}
            </div>
            <div>
                <label for="query">Id / Stripe id:</label>
                <br>
                {{ filter.form.search|as_crispy_field }}
            </div>
            <div>
                <button type="submit" class="primary-btn">Filter</button>
            </div>
        </form>
    </section>
    <!-- Orders list -->
    <section class="section" style="margin-top:20px;">
        <div class="section-title">
            <h3 class="title">Payment list</h3>
        </div>
        <div style="background:#FFF;
                    border:1px solid #E4E7ED;
                    padding:15px;
                    border-radius:8px">
            <table style="width:100%;border-collapse:collapse;">
                <thead>
                    <tr style="text-align:left;border-bottom:1px solid #E4E7ED;">
                        <th style="padding:10px 8px;">Id</th>
                        <th style="padding:10px 8px;">Stripe checkout id</th>
                        <th style="padding:10px 8px;">Customer</th>
                        <th style="padding:10px 8px;">Status</th>
                        <th style="padding:10px 8px;">Amount</th>
                        <th style="padding:10px 8px;">Date</th>
                        <th style="padding:12px 20px; text-align:right;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for payment in payments %}
                        <tr style="border-bottom:1px solid #F5F5F5;">
                            <td style="padding:12px 8px;">{{ payment.pk }}</td>
                            <td style="padding:12px 8px;">{{ payment.stripe_checkout_id|truncatechars:15 }}</td>
                            <td style="padding:12px 8px;">{{ payment.order.customer.username }}</td>
                            <td style="padding:12px 8px;">{{ payment.get_status_for_display }}</td>
                            <td style="padding:12px 8px;color:#D10024;font-weight:700;">{{ payment.amount }}</td>
                            <td style="padding:12px 8px;">{{ payment.created_at|date:"d-m-Y" }}</td>
                            <td style="padding:12px 8px;text-align:right;">
                                <a href="{% url "management-payments-update" payment.pk %}"
                                   class="primary-btn"
                                   style="padding:6px 12px;
                                          border-radius:20px;
                                          text-transform:none">Details</a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="6" style="padding:20px;text-align:center;color:#8D99AE;">No payments found</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- Pagination -->
        <div class="store-filter clearfix">
            {% if page_obj.has_other_pages %}
                <ul class="store-pagination">
                    {% if page_obj.has_previous %}
                        <li>
                            <a href="{% querystring page=page_obj.previous_page_number %}"><i class="fa fa-angle-left"></i></a>
                        </li>
                        <li>
                            <a href="{% querystring page=page_obj.previous_page_number %}">{{ page_obj.previous_page_number }}</a>
                        </li>
                    {% endif %}
                    <li class="active">{{ page_obj.number }}</li>
                    {% if page_obj.has_next %}
                        <li>
                            <a href="{% querystring page=page_obj.next_page_number %}">{{ page_obj.next_page_number }}</a>
                        </li>
                        <li>
                            <a href="{% querystring page=page_obj.next_page_number %}"><i class="fa fa-angle-right"></i></a>
                        </li>
                    {% endif %}
                </ul>
            {% endif %}
        </div>
    </section>
</div>
<footer id="bottom-footer" style="margin-top:40px;padding:20px 0;">
</footer>
